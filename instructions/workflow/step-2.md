# Step 2: PR 분할 전략 수립

이 단계는 **여러 PR로 나뉠 수 있는 큰 작업**의 PR 분할 전략을 수립하는 단계입니다.

---

## [CRITICAL] 레거시 코드 영향도 분석 (Pre-Check)
전략을 수립하기 전, 더 정확한 계획을 위해 기존 코드를 분석할지 사용자에게 제안하세요.

**AI의 필수 역제안**:
> "기존 코드를 분석해서 계획을 더 정확하게 만들까요? (토큰이 더 들긴 합니다.)
> 분석이 필요하다면 **어느 파일이나 폴더**를 보면 좋을지 알려주세요."

1.  **사용자가 위치를 알려준 경우**: 해당 코드를 분석하고 **`/plan/codebase-audit.md`**를 작성하세요.
2.  **필요 없다고 한 경우**: 이 단계를 건너뛰고 바로 '작업 크기 판단'으로 넘어가세요.

**분석 수행 및 문서화 (기존 수정 시)**:
관련 파일들을 열어보고, 분석한 결과를 `/plan/codebase-audit.md` 파일로 작성하세요.

**[📄 템플릿 보기](./template/codebase-audit.md)**

1.  **가용 자원 탐색**: 새로 만들려고 하는 기능 중 **이미 프로젝트에 구현된 것**이 있는지 찾아보세요. (유사한 컴포넌트, 유틸 함수 등)
2.  **수정 위치(Point) 특정**: 어느 파일의 어느 함수, 어느 라인 근처를 어떻게 건드려야 하는지 구체적으로 파악하세요.
3.  **중복 방지**: 기존 코드를 복사해서 새로 만들지 말고, 기존 것을 확장하거나 재사용할 방법을 고민하세요.

> **AI의 사고 과정**:
> "알림 모달을 새로 만들려고 했는데, 코드를 보니 `ConfirmModal`이 이미 있네? -> `codebase-audit.md`에 재사용 계획을 적고, `UserPage.tsx`의 120라인에 호출 로직만 추가하는 전략 수립"

---

## [CRITICAL] 작업 크기 판단

먼저 작업의 크기를 판단하세요:

- **작은 작업** (커밋 3개 이하 예상): 이 단계를 건너뛰고 바로 다음 단계(핵심 과제 정의)로 진행
- **큰 작업** (커밋 4개 이상, 또는 여러 도메인 포함): PR 분할 전략 수립 필요

AI는 작업이 작다고 판단되면 사용자에게 제안하세요:
> "이 작업은 약 [예상 커밋 개수]개의 커밋으로 구성될 것 같습니다. 단일 PR로 진행하고 이 단계를 건너뛰어 다음 단계(핵심 과제 정의)로 바로 가는 게 좋겠습니다. 괜찮으실까요?"

---

## [CRITICAL] 진행 원칙: 단일 PR & 단일 기능

**한 번에 하나의 PR, 하나의 구체적인 기능**만 다뤄야 합니다.

### PR 단위
- 하나의 `/plan/overview.md`는 하나의 PR에 해당합니다.
- 여러 PR로 나눌 경우, 각 PR마다 별도의 `/plan/overview.md` 작성예정

### 기능 세분화
- **❌ Bad (범위가 너무 큼)**: "게시판 CRUD 전체 개발"
- **✅ Good (적절히 분할)**:
  - PR #1: 게시판 리스트 조회(R) 기능
  - PR #2: 게시글 작성(C) 기능
  - PR #3: 게시글 수정/삭제(U/D) 기능
- **이유**: 한 번에 많은 기능을 다루면 리뷰와 테스트가 어려워집니다.

### PR 분할 실패 사례

**❌ Bad 예시 1 (너무 작게 쪼갬)**
```
PR #1: Button 컴포넌트 추가
PR #2: Input 컴포넌트 추가
PR #3: Form 컴포넌트 추가
PR #4: 로그인 페이지에서 Form 사용
```
문제: 의존성이 강한데 너무 잘게 쪼개서 각 PR이 의미 없음

**✅ Good 예시 1 (적절한 단위)**
```
PR #1: 공통 Form 컴포넌트 (Button, Input, Form 포함)
PR #2: 로그인 페이지 구현
```

**❌ Bad 예시 2 (너무 크게 묶음)**
```
PR #1: 사용자 인증 전체 시스템
  - 회원가입, 로그인, 비밀번호 찾기, 프로필 수정, 회원탈퇴
```
문제: 리뷰 시간이 과도하게 오래 걸리고, 일부만 문제 있어도 전체 배포 지연

**✅ Good 예시 2 (단계별 분할)**
```
PR #1: 로그인/회원가입 기능
PR #2: 비밀번호 찾기 기능
PR #3: 프로필 수정/회원탈퇴 기능
```

---

## PR 분할 전략 수립

### [CRITICAL] 기획 점검 (TODO 식별)
PR 전략을 수립한 후, **사용자에게 다음 질문을 반드시 하세요**:
> "각 PR을 진행하면서 미리 확인해야 할 기획 사항이나, 불확실해서 체크해야 할 Todo가 있으신가요?"

사용자의 답변 내용은 `/plan/project.md`에 기록하여, 이후 `overview.md` 작성 시 함께 체크해야 할 **TODO** 리스트로 관리합니다.

### 고려 사항
- 몇 개의 PR로 나눌 것인가?
- 각 PR의 범위는 무엇인가?
- PR 간 의존성은 어떻게 되는가?

### PR 분할 원칙
1. **독립성**: 각 PR은 독립적으로 배포 가능해야 함 (가능하면)
2. **작은 단위**: 리뷰와 테스트가 용이하도록 작게 나눔
3. **의존성 순서**: 공통 모듈 → 개별 페이지 순으로 진행
4. **리스크 분산**: 복잡한 기능은 단계적으로 배포

**기술적 과제는 다음 단계(핵심 과제 정의)에서 다룹니다.** 이 단계는 PR 분할에만 집중하세요.

---

## 작성 양식 (`/plan/project.md`)

### PR 분할 전략

#### 예시
```markdown
## PR 분할 전략

### PR #1: 네이티브 브릿지 API (앱팀 협업)
**범위:**
- 알림 권한 상태 조회 API
- 알림 권한 요청 트리거 API

**기획 확인 필요 (TODO):**
- [ ] iOS/Android 권한 거부 시 리턴되는 에러 코드값 확인 필요
- [ ] 권한 요청 팝업 문구 확정 여부 확인

**의존성:** 없음

### PR #2: 공통 모달 컴포넌트
**범위:**
- 독려 모달 (가운데 모달)
- 알림 OFF 안내 모달 (바텀시트)
- 2주 재노출 로직

**의존성:** PR #1

### PR #3: 이벤트/공지사항 페이지 통합
**범위:**
- 이벤트 페이지에 모달 통합
- 공지사항 페이지에 모달 통합

**의존성:** PR #1, #2 완료 필요
```

**핵심:**
- `project.md`는 전체 프로젝트 동안 유지
- `overview.md`는 각 PR마다 생성/삭제 반복
