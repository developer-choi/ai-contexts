# Step 3.5: 구현 방침 상세화 (Implementation Guidelines)

> **⚠️ 이 단계는 Step 3에서 기술 전략이 확정된 후에 진행합니다.**
>
> Step 3에서 선택지 비교와 최종 선택이 사용자에게 승인되면,
> 이 단계에서 선택된 기술의 **구체적인 구현 방침**을 작성합니다.

---

## 작성 목적

Step 3에서는 "무엇을(What) 선택할 것인가"를 결정했습니다.
이 단계에서는 "어떻게(How) 구현할 것인가"의 큰 그림을 그립니다.

**AI가 코드 작성 시 이 문서를 기반으로**:
- 로딩/성공/실패/엣지 케이스 대응 방법 파악
- 영향 범위를 확인하여 안전한 구현
- 중요한 비즈니스 로직 누락 방지

---

## 작성 양식 (`/plan/overview.md` 확장)

Step 3에서 작성한 `/plan/overview.md`의 **"3. 핵심 기술적 과제 및 기술 전략"** 섹션 아래에
**"4. 각 과제별 구현 방침"** 섹션을 추가합니다.

### 4. 각 과제별 구현 방침

각 과제마다 다음 형식으로 작성:

```markdown
**과제 N: [과제명]**

**구현 방침**:
- **초기/로딩**: [어떻게 처리]
- **성공**: [정상 동작]
- **실패**: [에러 처리 방법]
- **엣지 케이스**: [빈 데이터, 권한 거부 등 특수 상황]
- **수정/추가 파일**: [구체적인 파일 경로 목록]
```

---

## 작성 원칙

### ✅ 써야 할 것 (전략 레벨)

- **상태별 대응**: 로딩, 성공, 실패, 엣지 케이스를 어떻게 처리할지
- **핵심 흐름**: 3-5단계로 요약한 큰 흐름
- **수정/추가할 파일 목록**: 이번 PR에서 건드릴 파일 경로 리스트 (예: `src/pages/EventPage.tsx`)
- **중요한 비즈니스 로직**: 2주 재노출 기준, 권한 체크 시점 등
- **중요한 분기점**: 언제 어떤 조건으로 분기하는지

### ❌ 쓰지 않을 것 (AI가 판단 가능)

- Props 타입 상세 정의 (`title: string, onClose: () => void`)
- 변수명/함수명
- 10단계 이상의 상세 로직 (5단계 이내로 요약)
- 에러 메시지 문구
- 스타일링 가이드 (CSS, tailwind 클래스 등)
- 데이터 포맷 (날짜 포맷 등 - 기획서에 있음)

---

## 작성 예시

### 예시 1: 모달 구현

**과제 1: 독려 모달 구현**

**구현 방침**:
- **기본 흐름**: 기존 ConfirmModal 재사용, 네이티브 브릿지 API로 권한 확인
- **권한 GRANTED**: toggleNotification API 호출 → 성공 토스트 → 모달 닫기
- **권한 거부/미설정**: 설정 유도 모달(NotificationPermissionModal) 오픈
- **API 실패**: 에러 토스트 노출, 모달은 유지 (재시도 가능)
- **재노출 로직**: localStorage에 마지막 닫은 시각 저장, 2주(14일) 후 재노출
- **수정/추가 파일**:
  - `src/pages/EventPage.tsx` (독려 모달 통합)
  - `src/pages/NoticePage.tsx` (독려 모달 통합)
  - `src/hooks/useNotificationModal.ts` (새로 생성)

### 예시 2: 무한 스크롤

**과제 2: 무한 스크롤 구현**

**구현 방침**:
- **초기 로딩**: Skeleton 컴포넌트 3개 노출
- **데이터 표시**: useInfiniteQuery의 pages 배열 평탄화하여 렌더링
- **추가 로딩**: 리스트 하단에 Spinner 노출 (isFetchingNextPage)
- **스크롤 감지**: Intersection Observer로 sentinel div 감지 시 fetchNextPage 호출
- **네트워크 에러**: ErrorComponent 노출 (재시도 버튼 포함)
- **빈 리스트**: data.pages[0].list.length === 0일 때 EmptyContent 노출
- **수정/추가 파일**:
  - `src/pages/BoardListPage.tsx` (무한 스크롤 적용)
  - `src/hooks/useInfiniteScroll.ts` (새로 생성)
  - `src/components/BoardCard.tsx` (기존 활용)

---

## [CRITICAL] 다음 단계로 넘어가기 전 필수 확인

**⚠️ overview.md 구현 방침 추가를 완료한 후, 다음 단계(커밋 시퀀스 작성)로 넘어가기 전에 사용자 확인이 필요합니다.**

### AI의 필수 질문 (다음 단계 진행 전)

overview.md에 구현 방침을 추가한 후, 사용자에게 다음과 같이 물어보세요:

> "overview.md에 구현 방침을 추가했습니다.
>
> 다음 단계(커밋 시퀀스 작성)로 넘어가기 전에 확인이 필요합니다.
>
> **추가된 구현 방침을 읽고 이해하셨나요?**
> - 각 과제의 로딩/성공/실패/엣지 케이스 대응이 명확한가요?
> - 영향 범위가 적절한가요?
> - 이해가 안 되거나 불필요한 내용이 있나요?
>
> ⚠️ **구현 방침을 충분히 이해하지 못한 상태에서 다음 단계로 넘어가면, 잘못된 커밋 계획과 코드 작성으로 이어집니다.**
>
> **이해가 안 되거나 불필요한 내용이 있다면 지금 수정하고 넘어가야 합니다.**
>
> 모든 내용을 이해하셨다면 승인해주세요. 다음 단계를 시작하겠습니다."
